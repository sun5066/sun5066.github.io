---
title: "coroutine channel - 통신을 통한 메모리 공유"
date: 2021-08-20 12:44:28 -0400
categories: android
---

동시성과 관련된 수많은 오류는
서로 다른 스레드 간에 메모리를 공유할 때 발생한다.

예를 들면 다른 스레드에 의해 객체가 변경되는 경우에 문제가 생김
이런 식의 메모리 공유는 일명 "방탄 동기화" 가 없으면 위험하며 공유 객체가 절대로 들어가지 않아야 하는 상태에 빠질 때가 생긴다.
그리고 이러한 방탄 동기화를 작성하는 것은 보기보다 매우 어려움..

데드락, 레이스 컨디션, 원자성 위반은 공유 상태와 관련이 있다. 이들은 공유 상태가 유효하지 않기 때문에 발생하며, 상태가 일관성을 잃어버리는 원인이 되기도 함.

이런 문제를 극복하려는 차원에서 Kotlin, Go, Dart 와 같은 최신 프로그래밍 언어들은 Channel 을 제공함

채널은 스레드가 서로 다른 상태를 공유하는 대신 메시지를 주고받는 통신을 하도록 함으로써 동시성 코드를 작성하는 데 도움을 주는 도구다.

 # 채널의 이해
 * 동시성 코드 간에 서로 안전한 통신을 할 수 있도록 해주는 도구임.
 * 동시성 코드가 메시지를 보내 통신할 수 있도록 해줌.
 * 실행 중인 스레드에 상관 없이 서로 다른 코루틴 간에 메시지를 안전하게 보내고 받기 위한 파이프라인으로 생각할 수 있음.
> 채널이 어떻게 중요하고 현실적인 시나리오에서 사용될 수 있을까 몇 가지 예를 통해 살펴보자.

## 스트리밍 데이터 사례
최근에 특정 키워드에 대해 10개의 콘텐츠 인덱서를 조회한 뒤 검색 결과를 보여주는 비교적 간단한 프로그래밍 작업을 했다고 가정하자.

첫 번째 접근 방법은 각 콘텐츠 인덱서를 위한 코루틴을 시작해서 Deferred<List<ResultVO>> 를 반환하고, 모든 코루틴이 완료되면 결과를 병합해서 UI에 보내는 것이다.
