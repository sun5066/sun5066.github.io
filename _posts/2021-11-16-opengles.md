---
title: "android OpenGLES 환경설정 스터디"
date: 2021-11-16 9:00:00 -0400
categories: android, openGLES
---

# OpenGLES

---

- 크로노스 그룹에서 정의한 3차원 컴퓨터 그래픽스 API인 OpenGl의 SubSet으로 휴대전화, 단말, PDA같은 임베디드 단말을 위한 API
- 안드로이드 1.0 부터 OpenGl ES 1.0과 1.1을 지원했고, 안드로이드 2.2부터 OpenGL ES 2.0, 안드로이드 4.3 부터 OpenGL ES 3.0 안드로이드 5.0부터 OpenGL ES 3.1을 지원하고 있다.
- OpenGL ES를 이용하기 위해서는 GLSurfaceView를 이용하여 출력할 화면을 생성하고, 생성이 완료되면 GLSurfaceView에 등록한 GLSurfaceView.Renderer를 이용하여 그리기 작업을 진행한다.
- OpenGL ES 2.0 부터는 GL10을 사용X, GLES20, GLES30, GLE31 등 클래스를 직접 사용하여 처리한다.

---

- OpenGL ES를 사용하기 위해서는 매니페스트에 <uses-features>로 glEsVersion에 Version을 적어 주어야 한다. Version은 앞에 4자리로 major-version을 뒤에 4자리에 minor version을 적는다.
  예를 들어 2.0은 0x00020000, 3.1은 0x00030001 과 같이 적는다.
  
- GLSurfaceView의 setEGLContextClientVersion()로 GLES의 major version을 설정해 주어야함.

```
<uses-feature android:glEsVersion="0x00030001" android:required="true" />
```

---


# GLSurfaceView

---

- GLSurfaceView는 안드로이드에서 OpenGL ES를 이용하여 그리기를 한 결과를 화면에 나타낼수 있 도록 제공되는 View
- GLSurfaceView에 GLSurfaceView.Renderer를 등록하면
  GLSurfaceView는 Surface가 생성되면, Surface를 OpenGL ES가 Surface에
  그림을 그리도록 EGLSurface를 생성하고 내부적으로 만든 Thread에서 등록된
  Renderer의 onSurfaceCreated(), onSurfaceChanged(), onDrawFrame()을 호출하여 OpenGL ES를 이용한 그리기를 할 수 있또록 해준다.
  
- GLSurfaceView의 setEGLContextClientVersion()으로 사용하려는 OpenGL의 Version을 설정해 주어야 한다. 2.0을 사용하면 2, 3.0 혹은 3.1을 사용하려면 3을 설정해준다.

- 그리기는 default는 반복적으로 onDrawFrame()을 호출하여 그리기를 수행한다. 그리기를 수동으로 제어하려면, setRenderMode()로 RENDERMODE_SET_DIRTY를 설정하고,
  다시 그리기가 필요한 경우 requestRender()를 호출하여 다시 그리기를 해 준다. setRenderMode()의 설정은 반드시 Renderer를 등록한 다음 호출해 주어야 한다.
  setRenderer()가 호출되어 등록되지 않은 상태에서는 Thread가 생성되지 않아 Exception이 발생한다.
  
- Renderer의 onSurfaceCreate()에서는 화면 초기화, 그릴 객체의 생성 등을 처리하고,
  onSurfaceChanged()에서는 Viewport를 설정하고, Clip 영역 좌표로 변경할 Projection 행렬을 생성하는 작업을 한다.
  onDrawFrame()에서는 View행렬을 생성하고 객체에 대한 그리기를 진행한다.
  
---

# GLSufaceView에 빨간색 색칠하기

- 먼저 매니페스트에 2.0 버전을 추가해줍니다.

```
<uses-feature android:glEsVersion="0x00020000" android:required="true" />
```

- app.gradle android에 바인딩 옵션 추가해줍니다.
```
android {
    ...

    buildFeatures {
        viewBinding = true
        dataBinding = true
    }
}
```

- MainActivity에 작성해줍니다.
```
class MainActivity : AppCompatActivity() {

    private lateinit var binding: ActivityMainBinding

    private val glSurfaceViewRenderer = object : GLSurfaceView.Renderer {
        override fun onSurfaceCreated(gl: GL10?, config: EGLConfig?) {
            GLES20.glClearColor(5.0f, 0.0f, 0.0f, 1.0f)
        }
        override fun onSurfaceChanged(gl: GL10?, width: Int, height: Int) {
            GLES20.glViewport(0, 0, width, height)
        }
        override fun onDrawFrame(gl: GL10?) {
            GLES20.glClear(GLES20.GL_COLOR_BUFFER_BIT)
        }
    }

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)

        binding = DataBindingUtil.setContentView(this, R.layout.activity_main)
        with(binding.surfaceView) {
            setEGLContextClientVersion(3)
            setRenderer(glSurfaceViewRenderer)
            renderMode = GLSurfaceView.RENDERMODE_WHEN_DIRTY
        }
    }
}
```

---

## 참고자료

[유튜브 채널 T아카데미](https://youtu.be/PjroUrwpfRE),
[공식 홈페이지](https://developer.android.com/training/graphics/opengl/environment?hl=ko)

---