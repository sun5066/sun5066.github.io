---
layout: post
title: "Android Zygote에 대해서 알아보자"
date: 2023-07-31 09:20:00 -0400 
categories: android
tags: android zygote
comments: 1
---

### Zygote 란?

안드로이드 애플리케이션을 빠르게 실행하기 위한 도구로 DEX 중간 언어로 컴파일된 서비스를 위한 가상머신과 런타임 환경을 생성 해 줌.

Zygote는 Desktop 용 JVM의 문제 중 느린 앱 실행 속도를 해결 하기 위한 해결책이었다.
만약 안드로이드에 Zygote가 없었다고 가정해보면, 느린 앱 실행과 앱이 실행될 때마다 발생하는 리소스는 모바일에서 가장 중요한 배터리 전력을 정말 야무지게 갉아 먹었을 것이다.

그럼 Zygote는 어떻게 가볍고 빠르게 실행되는걸까?

- 미리 로드된 런타임: 안드로이드 기기가 부팅될 때, Zygote 프로세스는 미리 ART를 로드하여 메모리에 상주시킨다. 이로 인해 새로운 앱을 실행할 때마다 ART를 다시 로드할 필요가 없기 때문에 리소스와 실행 시간이 절약됨
- Process Fork: Zygote는 새로운 앱 프로세스를 생성 할 때 Fork 매커니즘을 사용한다. Zygote는 자기 자신을 복제(clone)해서 시스템 수준의 프로세스인 Zygote`를 생성한다.
  - 그렇게 복제된 Zygote` 프로세스와 부모 Zygote 프로세스가 완전히 동일한 메모리를 공유하기 때문에 자식 프로세스는 순식간에 시작하게 된다.
  - 커널은 새로운 프로세스를 위해 많은 리소스를 사용할 필요도 없으며, 안드로이드 프레임워크 라이브러리를 로드할 필요도 없다.(Zygote가 이미 모든 것을 로드해 두었기 때문에)

> fork 된 Zygote` 프로세스와 부모 Zygote 프로세스는 동일한 물리적 메모리 주소를 갖기 때문에 두 프로세스 중 하나에서 메모리 내용을 변경시 다른 프로세스도 영향을 받는 상황이 생길 수 있기 때문에 COW(Copy-on-Write) 페이징 기법을 사용한다.

#### Zygote 시작

Zygote는 init에 의해 실행되며 init에 대해 짧게 설명한 글이 존재한다.
부끄럽지만 한번 참고해보는것도 나쁘지 않을것같다.[Android init Process에 대해서(짧게) 알아보자](https://sun5066.github.io/2023/07/27/init-process)

init은 app_process를 실행하고 결과 프로세스에 zygote라는 이름을 부여한다.

`service zygote /system/bin/app_process - Xzygote /system/bin --zygote --start-system-server`

- 샬라샬라.. 작성중